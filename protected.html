<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Protected Content</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="scripts/config.js"></script>
    <script src="scripts/auth.js"></script>
</head>

<body onload="checkAccess()">

<header>
    <nav>
        <a href="index.html">Home</a>
        <a href="member/noah.html">Noah</a>
        <a href="member/emre.html">Henry</a>
        <a href="member/roberto.html">Roberto</a>
        <a href="member/juan.html">Juan</a>
    </nav>
</header>

<h2>Protected Content</h2>

<!-- Login Box (Visible only if NOT authenticated) -->
<div id="login-box">
    <p>This content is protected. Please enter the password:</p>
    <input type="password" id="password" placeholder="Enter Password">
    <button onclick="login()">Submit</button>
    <p id="error"></p>
</div>

<!-- Private Content (Visible only after authentication) -->
<div id="private-content" style="display:none;">
    <p>You are logged in. Select a stored message to view:</p>

    <h3>Messages</h3>
    <ul id="messageList">
        <!-- JS loads message links here dynamically -->
    </ul>

    <button onclick="logout()">Logout</button>
</div>

<script>
function logout() {
    sessionStorage.removeItem("auth");
    location.reload();
}
</script>

    <script>
async function loadMessages() {
    const username = "emreakgl";
    const repo = "team10-Portfolio";

    const apiURL = `https://api.github.com/repos/emreakgl/team10-Portfolio/contents/protected/messages`;

    try {
        const response = await fetch(apiURL);
        const files = await response.json();

        const list = document.getElementById("messageList");
        list.innerHTML = "";

        files.forEach(file => {
            if (file.name.endsWith(".html")) {
                const li = document.createElement("li");

                // Public GitHub Pages URL for each file
                const fileURL = `https://emreakgl.github.io/team10-Portfolio/protected/messages/${file.name}`;

                li.innerHTML = `<a href="${fileURL}" target="_blank">${file.name}</a>`;
                list.appendChild(li);
            }
        });

    } catch (e) {
        console.error("Error loading messages:", e);
        document.getElementById("messageList").innerHTML = "<li>Error loading messages.</li>";
    }
}

window.onload = loadMessages;
</script>

</body>
</html>
